(function(L,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],g):(L=typeof globalThis<"u"?globalThis:L||self,g(L.ReactEnahncedImage={},L.React))})(this,function(L,g){"use strict";var $={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee;function ae(){if(ee)return X;ee=1;var n=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function c(s,f,m){var v=null;if(m!==void 0&&(v=""+m),f.key!==void 0&&(v=""+f.key),"key"in f){m={};for(var a in f)a!=="key"&&(m[a]=f[a])}else m=f;return f=m.ref,{$$typeof:n,type:s,key:v,ref:f!==void 0?f:null,props:m}}return X.Fragment=o,X.jsx=c,X.jsxs=c,X}var U={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te;function ue(){return te||(te=1,process.env.NODE_ENV!=="production"&&function(){function n(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===r?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case k:return"Fragment";case W:return"Profiler";case j:return"StrictMode";case u:return"Suspense";case T:return"SuspenseList";case y:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case w:return"Portal";case I:return(e.displayName||"Context")+".Provider";case D:return(e._context.displayName||"Context")+".Consumer";case z:var d=e.render;return e=e.displayName,e||(e=d.displayName||d.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case b:return d=e.displayName||null,d!==null?d:n(e.type)||"Memo";case h:d=e._payload,e=e._init;try{return n(e(d))}catch{}}return null}function o(e){return""+e}function c(e){try{o(e);var d=!1}catch{d=!0}if(d){d=console;var x=d.error,_=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return x.call(d,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",_),o(e)}}function s(e){if(e===k)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===h)return"<...>";try{var d=n(e);return d?"<"+d+">":"<...>"}catch{return"<...>"}}function f(){var e=t.A;return e===null?null:e.getOwner()}function m(){return Error("react-stack-top-frame")}function v(e){if(i.call(e,"key")){var d=Object.getOwnPropertyDescriptor(e,"key").get;if(d&&d.isReactWarning)return!1}return e.key!==void 0}function a(e,d){function x(){O||(O=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",d))}x.isReactWarning=!0,Object.defineProperty(e,"key",{get:x,configurable:!0})}function E(){var e=n(this.type);return Z[e]||(Z[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function p(e,d,x,_,N,Y,G,Q){return x=Y.ref,e={$$typeof:R,type:e,key:d,props:Y,_owner:N},(x!==void 0?x:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:E}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:G}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Q}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function M(e,d,x,_,N,Y,G,Q){var C=d.children;if(C!==void 0)if(_)if(A(C)){for(_=0;_<C.length;_++)l(C[_]);Object.freeze&&Object.freeze(C)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else l(C);if(i.call(d,"key")){C=n(e);var F=Object.keys(d).filter(function(xe){return xe!=="key"});_=0<F.length?"{key: someKey, "+F.join(": ..., ")+": ...}":"{key: someKey}",ie[C+_]||(F=0<F.length?"{"+F.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,_,C,F,C),ie[C+_]=!0)}if(C=null,x!==void 0&&(c(x),C=""+x),v(d)&&(c(d.key),C=""+d.key),"key"in d){x={};for(var K in d)K!=="key"&&(x[K]=d[K])}else x=d;return C&&a(x,typeof e=="function"?e.displayName||e.name||"Unknown":e),p(e,C,Y,N,f(),x,G,Q)}function l(e){typeof e=="object"&&e!==null&&e.$$typeof===R&&e._store&&(e._store.validated=1)}var S=g,R=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),I=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),r=Symbol.for("react.client.reference"),t=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,i=Object.prototype.hasOwnProperty,A=Array.isArray,P=console.createTask?console.createTask:function(){return null};S={"react-stack-bottom-frame":function(e){return e()}};var O,Z={},q=S["react-stack-bottom-frame"].bind(S,m)(),ce=P(s(m)),ie={};U.Fragment=k,U.jsx=function(e,d,x,_,N){var Y=1e4>t.recentlyCreatedOwnerStacks++;return M(e,d,x,!1,_,N,Y?Error("react-stack-top-frame"):q,Y?P(s(e)):ce)},U.jsxs=function(e,d,x,_,N){var Y=1e4>t.recentlyCreatedOwnerStacks++;return M(e,d,x,!0,_,N,Y?Error("react-stack-top-frame"):q,Y?P(s(e)):ce)}}()),U}var ne;function le(){return ne||(ne=1,process.env.NODE_ENV==="production"?$.exports=ae():$.exports=ue()),$.exports}var B=le();const re=n=>{let o;const c=new Set,s=(p,M)=>{const l=typeof p=="function"?p(o):p;if(!Object.is(l,o)){const S=o;o=M??(typeof l!="object"||l===null)?l:Object.assign({},o,l),c.forEach(R=>R(o,S))}},f=()=>o,a={setState:s,getState:f,getInitialState:()=>E,subscribe:p=>(c.add(p),()=>c.delete(p))},E=o=n(s,f,a);return a},fe=n=>n?re(n):re,de=n=>n;function he(n,o=de){const c=g.useSyncExternalStore(n.subscribe,()=>o(n.getState()),()=>o(n.getInitialState()));return g.useDebugValue(c),c}const oe=n=>{const o=fe(n),c=s=>he(o,s);return Object.assign(c,o),c},H=n=>n?oe(n):oe,me=H(n=>({canvases:{},addCanvas:(o,c)=>n(s=>s.canvases[c]?s:{canvases:{...s.canvases,[c]:o}}),updateCanvas:(o,c)=>n(s=>({canvases:{...s.canvases,[c]:o}}))})),se=n=>{const{canvases:o,updateCanvas:c,addCanvas:s}=me(),f=g.useMemo(()=>o[n],[o]);return{canvas:f,setZoom:E=>{f&&c({...f,zoom:E},n)},setRotation:E=>{f&&c({...f,rotation:E},n)},initCanvas:E=>{console.log("init",E,n),s(E,n)}}},ge=H(n=>({stickers:void 0,selectedSticker:void 0,addSticker:(o,c)=>n(s=>{const f=s.stickers?.[c]?.stickers||[];return{stickers:{...s.stickers,[c]:{stickers:[...f,o]}}}}),updateSticker:(o,c)=>n(s=>{const m=(s.stickers?.[c]?.stickers||[]).map(v=>v.id===o.id?o:v);return{stickers:{...s.stickers,[c]:{stickers:m}}}}),updateAll:(o,c)=>n(s=>({stickers:{...s.stickers,[c]:{stickers:o}}})),removeSticker:(o,c)=>n(s=>{const m=(s.stickers?.[c]?.stickers||[]).filter(a=>a.id!==o),v={...s.selectedSticker};return v?.[c]===o&&(v[c]=void 0),{stickers:{...s.stickers,[c]:{stickers:m}},selectedSticker:v}}),setSelectedSticker:(o,c)=>n(s=>({selectedSticker:{...s.selectedSticker,[o]:c}}))})),J=n=>{const{stickers:o,selectedSticker:c,addSticker:s,removeSticker:f,setSelectedSticker:m,updateSticker:v,updateAll:a}=ge(),E=g.useMemo(()=>o?.[n]?.stickers,[o]),p=g.useMemo(()=>c?.[n],[c]);return{stickers:E,selectedSticker:p,addSticker:async l=>{const{width:S,height:R}=await ve(l),w={id:new Date().toString(),type:"sticker",src:l,x:Math.random()*200,y:Math.random()*200,width:S,height:R};s(w,n)},removeSticker:l=>f(l,n),setSelectedSticker:l=>m(n,l),updateSticker:l=>v(l,n),updateAllStickers:l=>a(l,n)}};function ve(n){return new Promise((o,c)=>{const s=new Image;s.onload=()=>o({width:s.width,height:s.height}),s.onerror=c,s.src=n})}function Se(n,o,c){const{stickers:s,selectedSticker:f,setSelectedSticker:m,updateAllStickers:v}=J(o),[a,E]=g.useState(null),[p,M]=g.useState(null),[l,S]=g.useState(null),R=g.useRef({x:0,y:0}),w=g.useRef({x:0,y:0}),k=g.useRef({width:0,height:0}),j=(u,T)=>{if(s)for(let b=s.length-1;b>=0;b--){const h=s[b];if(u>=h.x&&u<=h.x+h.width&&T>=h.y&&T<=h.y+h.height)return h}},W=(u,T,b,h=10)=>{const y={tl:{x:u.x,y:u.y},tr:{x:u.x+u.width,y:u.y},bl:{x:u.x,y:u.y+u.height},br:{x:u.x+u.width,y:u.y+u.height}};for(const r in y){if(!r)continue;const t=y[r].x,i=y[r].y;if(Math.abs(T-t)<=h&&Math.abs(b-i)<=h)return r}return null},D=(u,T)=>{const b=s?.find(y=>y.id===f);if(b){const y=W(b,u,T);if(y){M(b.id),S(y),w.current={x:u,y:T},k.current={width:b.width,height:b.height},c?.(!0);return}}const h=j(u,T);h?(E(h.id),R.current={x:u-h.x,y:T-h.y},c?.(!0),m?.(h.id)):m?.(void 0)},I=(u,T)=>{if(p&&l){const h=u-w.current.x,y=T-w.current.y,r=s?.map(t=>{if(t.id!==p)return t;let i=k.current.width,A=k.current.height;switch(l){case"tl":{const P=k.current.width-h,O=k.current.height-y;i=Math.max(P,10),A=Math.max(O,10);break}case"tr":{const P=k.current.width+h,O=k.current.height-y;i=Math.max(P,10),A=Math.max(O,10);break}case"bl":{const P=k.current.width-h,O=k.current.height+y;i=Math.max(P,10),A=Math.max(O,10);break}case"br":{const P=k.current.width+h,O=k.current.height+y;i=Math.max(P,10),A=Math.max(O,10);break}}return i=Math.max(10,i),A=Math.max(10,A),{...t,width:i,height:A}});r&&v?.(r);return}if(!a)return;const b=s?.map(h=>h.id===a?{...h,x:u-R.current.x,y:T-R.current.y}:h);b&&v?.(b)},z=()=>{E(null),M(null),S(null),c?.(!1)};g.useEffect(()=>{const u=n.current;if(!u)return;const T=b=>{const h=u.getBoundingClientRect(),y=b.clientX-h.left,r=b.clientY-h.top,t=s?.find(i=>i.id===f);if(t){const i=W(t,y,r);if(i){const A={tl:"nwse-resize",br:"nwse-resize",tr:"nesw-resize",bl:"nesw-resize"};u.style.cursor=A[i];return}}u.style.cursor=a||p?"grabbing":"default"};return u.addEventListener("mousemove",T),()=>{u.removeEventListener("mousemove",T),u.style.cursor="default"}},[n,s,m,a,p]),g.useEffect(()=>{const u=n.current;if(!u)return;const T=r=>{const t=u.getBoundingClientRect();D(r.clientX-t.left,r.clientY-t.top)},b=r=>{if(!a&&!p)return;const t=u.getBoundingClientRect();I(r.clientX-t.left,r.clientY-t.top)},h=r=>{if(r.touches.length!==1)return;const t=u.getBoundingClientRect(),i=r.touches[0];D(i.clientX-t.left,i.clientY-t.top)},y=r=>{if(r.touches.length!==1||!a&&!p)return;const t=u.getBoundingClientRect(),i=r.touches[0];I(i.clientX-t.left,i.clientY-t.top)};return u.addEventListener("mousedown",T),window.addEventListener("mousemove",b),window.addEventListener("mouseup",z),u.addEventListener("touchstart",h,{passive:!1}),window.addEventListener("touchmove",y,{passive:!1}),window.addEventListener("touchend",z),()=>{u.removeEventListener("mousedown",T),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",z),u.removeEventListener("touchstart",h),window.removeEventListener("touchmove",y),window.removeEventListener("touchend",z)}},[n,a,p,l,s,v,c,m])}const V=H(()=>({canvasRefs:{},setCanvasRef:(n,o)=>{V.getState().canvasRefs[n]=o}})),we=H(()=>{const n={current:null};return{finalImageRef:n,setFinalImage:o=>{n.current=o},getFinalImage:()=>n.current}});function Ee({canvasId:n}){const{canvasRefs:o}=V(),c=g.useRef(null),[s,f]=g.useState({x:0,y:0}),[m,v]=g.useState(!1),a=g.useRef(null),{stickers:E,selectedSticker:p}=J(n),{canvas:{image:M,cropHeight:l,cropWidth:S,rotation:R,zoom:w},setZoom:k}=se(n),j=(r,t,i)=>Math.min(Math.max(r,t),i),W=r=>{if(!a.current||m)return;const t=w/100,i=a.current.width*t,A=a.current.height*t,P=Math.max(0,(i-S)/2),O=Math.max(0,(A-l)/2),Z=j(r.x,-P,P),q=j(r.y,-O,O);f({x:Z,y:q})};g.useEffect(()=>{const r=new Image;r.onload=()=>{a.current=r,y()},r.src=M},[M,w,s,R,E,p]);const D=(r,t,i)=>{r.save(),r.fillStyle="#007bff",r.strokeStyle="#fff",r.lineWidth=2,r.beginPath(),r.rect(t-10/2,i-10/2,10,10),r.fill(),r.stroke(),r.restore()},I=g.useRef({}),z=()=>{const r=c.current??o[n].current,t=r?.getContext("2d");if(!r||!t||!a.current)return;r.width=S,r.height=l,t.clearRect(0,0,S,l),t.save();const i=w/100;return t.translate(s.x+S/2,s.y+l/2),t.rotate(R*Math.PI/180),t.scale(i,i),t.drawImage(a.current,-a.current.width/2,-a.current.height/2),t.restore(),t},u=(r,t)=>{let i=I.current[t.src];if(!i){i=new Image,i.src=t.src,I.current[t.src]=i,i.onload=()=>y();return}i.complete&&r.drawImage(i,t.x,t.y,t.width,t.height)},T=(r,t)=>{r.font=`${t.height}px sans-serif`,r.textAlign="left",r.textBaseline="top",r.fillText(t.src,t.x,t.y)},b=(r,t)=>{r.strokeStyle="#007bff",r.lineWidth=2,r.strokeRect(t.x,t.y,t.width,t.height),D(r,t.x,t.y),D(r,t.x+t.width,t.y),D(r,t.x,t.y+t.height),D(r,t.x+t.width,t.y+t.height)},h=r=>{const t=r.toDataURL();return we.getState().setFinalImage({dataUrl:t,metaData:{stickers:E??[]}}),{dataUrl:t,metaData:{stickers:E}}},y=()=>{const r=c??o[n],t=z();if(!(!t||!r.current))return E?.forEach(i=>{i.src.startsWith("data:image")||i.src.startsWith("http")?u(t,i):T(t,i),i.id===p&&b(t,i)}),h(r.current)};return Se(c??o[n],n,v),{canvasRef:c,clamp:j,setCurrentZoom:k,currentZoom:w,setPosition:W,position:s,drawCanvas:y}}function pe(n,o){const c=g.useRef(!1),s=g.useRef({x:0,y:0});return{onMouseDown:a=>{c.current=!0,s.current={x:a.clientX-o.x,y:a.clientY-o.y}},onMouseMove:a=>{c.current&&n(a.clientX-s.current.x,a.clientY-s.current.y)},onMouseUp:()=>{c.current=!1}}}function be(n,o,c,s,f){const m=g.useRef(!1),v=g.useRef({x:0,y:0}),a=g.useRef(null);return{onTouchStart:l=>{if(l.touches.length===1){const S=l.touches[0];m.current=!0,v.current={x:S.clientX-o.x,y:S.clientY-o.y}}else if(l.touches.length===2){const[S,R]=Array.from(l.touches),w=Math.hypot(R.clientX-S.clientX,R.clientY-S.clientY);a.current=w}},onTouchMove:l=>{if(l.preventDefault(),l.touches.length===1&&m.current){const S=l.touches[0];n(S.clientX-v.current.x,S.clientY-v.current.y)}else if(l.touches.length===2){const[S,R]=Array.from(l.touches),w=Math.hypot(R.clientX-S.clientX,R.clientY-S.clientY);if(a.current!=null){const j=(w-a.current)*.3;c(f(s+j,10,500))}a.current=w}},onTouchEnd:()=>{m.current=!1,a.current=null}}}function ye({id:n}){const{canvasRef:o,clamp:c,setCurrentZoom:s,currentZoom:f,setPosition:m,position:v}=Ee({canvasId:n}),{onMouseDown:a,onMouseMove:E,onMouseUp:p}=pe((w,k)=>m({x:w,y:k}),v),{onTouchStart:M,onTouchMove:l,onTouchEnd:S}=be((w,k)=>m({x:w,y:k}),v,s,f,c),R=w=>{w.preventDefault();const j=-w.deltaY*.1;s(f+j)};return g.useEffect(()=>{const w=o.current;if(w)return w.addEventListener("wheel",R,{passive:!1}),()=>{w.removeEventListener("wheel",R)}},[o,f]),g.useEffect(()=>{V.getState().setCanvasRef(n,o)},[n]),B.jsx("canvas",{ref:o,style:{touchAction:"none",cursor:"grab"},onMouseDown:a,onMouseMove:E,onMouseUp:p,onMouseLeave:p,onTouchStart:M,onTouchMove:l,onTouchEnd:S})}const ke=({id:n,image:o,cropWidth:c,cropHeight:s,zoom:f,rotation:m})=>{const{initCanvas:v}=se(n),[a,E]=g.useState(!1);return g.useEffect(()=>{v({image:o,zoom:f,cropHeight:s,cropWidth:c,rotation:m}),E(!0)},[]),B.jsx(B.Fragment,{children:a&&B.jsx(ye,{id:n})})};L.EnhancedImage=ke,L.useStickers=J,Object.defineProperty(L,Symbol.toStringTag,{value:"Module"})});
