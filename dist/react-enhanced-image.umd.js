(function(I,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],g):(I=typeof globalThis<"u"?globalThis:I||self,g(I.ReactEnahncedImage={},I.React))})(this,function(I,g){"use strict";var $={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee;function ue(){if(ee)return X;ee=1;var t=Symbol.for("react.transitional.element"),o=Symbol.for("react.fragment");function c(r,l,m){var v=null;if(m!==void 0&&(v=""+m),l.key!==void 0&&(v=""+l.key),"key"in l){m={};for(var i in l)i!=="key"&&(m[i]=l[i])}else m=l;return l=m.ref,{$$typeof:t,type:r,key:v,ref:l!==void 0?l:null,props:m}}return X.Fragment=o,X.jsx=c,X.jsxs=c,X}var U={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te;function le(){return te||(te=1,process.env.NODE_ENV!=="production"&&function(){function t(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===s?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case x:return"Fragment";case W:return"Profiler";case j:return"StrictMode";case u:return"Suspense";case T:return"SuspenseList";case y:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case w:return"Portal";case N:return(e.displayName||"Context")+".Provider";case D:return(e._context.displayName||"Context")+".Consumer";case L:var d=e.render;return e=e.displayName,e||(e=d.displayName||d.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case b:return d=e.displayName||null,d!==null?d:t(e.type)||"Memo";case h:d=e._payload,e=e._init;try{return t(e(d))}catch{}}return null}function o(e){return""+e}function c(e){try{o(e);var d=!1}catch{d=!0}if(d){d=console;var k=d.error,_=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return k.call(d,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",_),o(e)}}function r(e){if(e===x)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===h)return"<...>";try{var d=t(e);return d?"<"+d+">":"<...>"}catch{return"<...>"}}function l(){var e=n.A;return e===null?null:e.getOwner()}function m(){return Error("react-stack-top-frame")}function v(e){if(a.call(e,"key")){var d=Object.getOwnPropertyDescriptor(e,"key").get;if(d&&d.isReactWarning)return!1}return e.key!==void 0}function i(e,d){function k(){O||(O=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",d))}k.isReactWarning=!0,Object.defineProperty(e,"key",{get:k,configurable:!0})}function E(){var e=t(this.type);return q[e]||(q[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function p(e,d,k,_,z,Y,G,Q){return k=Y.ref,e={$$typeof:R,type:e,key:d,props:Y,_owner:z},(k!==void 0?k:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:E}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:G}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Q}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function M(e,d,k,_,z,Y,G,Q){var C=d.children;if(C!==void 0)if(_)if(P(C)){for(_=0;_<C.length;_++)f(C[_]);Object.freeze&&Object.freeze(C)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else f(C);if(a.call(d,"key")){C=t(e);var F=Object.keys(d).filter(function(Re){return Re!=="key"});_=0<F.length?"{key: someKey, "+F.join(": ..., ")+": ...}":"{key: someKey}",ie[C+_]||(F=0<F.length?"{"+F.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,_,C,F,C),ie[C+_]=!0)}if(C=null,k!==void 0&&(c(k),C=""+k),v(d)&&(c(d.key),C=""+d.key),"key"in d){k={};for(var K in d)K!=="key"&&(k[K]=d[K])}else k=d;return C&&i(k,typeof e=="function"?e.displayName||e.name||"Unknown":e),p(e,C,Y,z,l(),k,G,Q)}function f(e){typeof e=="object"&&e!==null&&e.$$typeof===R&&e._store&&(e._store.validated=1)}var S=g,R=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),x=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),N=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),s=Symbol.for("react.client.reference"),n=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,a=Object.prototype.hasOwnProperty,P=Array.isArray,A=console.createTask?console.createTask:function(){return null};S={"react-stack-bottom-frame":function(e){return e()}};var O,q={},J=S["react-stack-bottom-frame"].bind(S,m)(),ae=A(r(m)),ie={};U.Fragment=x,U.jsx=function(e,d,k,_,z){var Y=1e4>n.recentlyCreatedOwnerStacks++;return M(e,d,k,!1,_,z,Y?Error("react-stack-top-frame"):J,Y?A(r(e)):ae)},U.jsxs=function(e,d,k,_,z){var Y=1e4>n.recentlyCreatedOwnerStacks++;return M(e,d,k,!0,_,z,Y?Error("react-stack-top-frame"):J,Y?A(r(e)):ae)}}()),U}var ne;function fe(){return ne||(ne=1,process.env.NODE_ENV==="production"?$.exports=ue():$.exports=le()),$.exports}var B=fe();const re=t=>{let o;const c=new Set,r=(p,M)=>{const f=typeof p=="function"?p(o):p;if(!Object.is(f,o)){const S=o;o=M??(typeof f!="object"||f===null)?f:Object.assign({},o,f),c.forEach(R=>R(o,S))}},l=()=>o,i={setState:r,getState:l,getInitialState:()=>E,subscribe:p=>(c.add(p),()=>c.delete(p))},E=o=t(r,l,i);return i},de=t=>t?re(t):re,he=t=>t;function me(t,o=he){const c=g.useSyncExternalStore(t.subscribe,()=>o(t.getState()),()=>o(t.getInitialState()));return g.useDebugValue(c),c}const oe=t=>{const o=de(t),c=r=>me(o,r);return Object.assign(c,o),c},H=t=>t?oe(t):oe,ge=H(t=>({canvases:{},addCanvas:(o,c)=>t(r=>r.canvases[c]?r:{canvases:{...r.canvases,[c]:o}}),updateCanvas:(o,c)=>t(r=>({canvases:{...r.canvases,[c]:o}}))})),se=t=>{const{canvases:o,updateCanvas:c,addCanvas:r}=ge(),l=g.useMemo(()=>o[t],[o]);return{canvas:l,setZoom:E=>{l&&c({...l,zoom:E},t)},setRotation:E=>{l&&c({...l,rotation:E},t)},initCanvas:E=>{console.log("init",E,t),r(E,t)}}},ve=H(t=>({stickers:void 0,selectedSticker:void 0,addSticker:(o,c)=>t(r=>{const l=r.stickers?.[c]?.stickers||[];return{stickers:{...r.stickers,[c]:{stickers:[...l,o]}}}}),updateSticker:(o,c)=>t(r=>{const m=(r.stickers?.[c]?.stickers||[]).map(v=>v.id===o.id?o:v);return{stickers:{...r.stickers,[c]:{stickers:m}}}}),updateAll:(o,c)=>t(r=>({stickers:{...r.stickers,[c]:{stickers:o}}})),removeSticker:(o,c)=>t(r=>{const m=(r.stickers?.[c]?.stickers||[]).filter(i=>i.id!==o),v={...r.selectedSticker};return v?.[c]===o&&(v[c]=void 0),{stickers:{...r.stickers,[c]:{stickers:m}},selectedSticker:v}}),setSelectedSticker:(o,c)=>t(r=>({selectedSticker:{...r.selectedSticker,[o]:c}}))})),Z=t=>{const{stickers:o,selectedSticker:c,addSticker:r,removeSticker:l,setSelectedSticker:m,updateSticker:v,updateAll:i}=ve(),E=g.useMemo(()=>o?.[t]?.stickers,[o]),p=g.useMemo(()=>c?.[t],[c]);return{stickers:E,selectedSticker:p,addSticker:async f=>{const{width:S,height:R}=await Se(f),w={id:new Date().toString(),type:"sticker",src:f,x:Math.random()*200,y:Math.random()*200,width:S,height:R};r(w,t)},removeSticker:f=>l(f,t),setSelectedSticker:f=>m(t,f),updateSticker:f=>v(f,t),updateAllStickers:f=>i(f,t)}};function Se(t){return new Promise((o,c)=>{const r=new Image;r.onload=()=>o({width:r.width,height:r.height}),r.onerror=c,r.src=t})}function we(t,o,c){const{stickers:r,selectedSticker:l,setSelectedSticker:m,updateAllStickers:v}=Z(o),[i,E]=g.useState(null),[p,M]=g.useState(null),[f,S]=g.useState(null),R=g.useRef({x:0,y:0}),w=g.useRef({x:0,y:0}),x=g.useRef({width:0,height:0}),j=(u,T)=>{if(r)for(let b=r.length-1;b>=0;b--){const h=r[b];if(u>=h.x&&u<=h.x+h.width&&T>=h.y&&T<=h.y+h.height)return h}},W=(u,T,b,h=10)=>{const y={tl:{x:u.x,y:u.y},tr:{x:u.x+u.width,y:u.y},bl:{x:u.x,y:u.y+u.height},br:{x:u.x+u.width,y:u.y+u.height}};for(const s in y){if(!s)continue;const n=y[s].x,a=y[s].y;if(Math.abs(T-n)<=h&&Math.abs(b-a)<=h)return s}return null},D=(u,T)=>{const b=r?.find(y=>y.id===l);if(b){const y=W(b,u,T);if(y){M(b.id),S(y),w.current={x:u,y:T},x.current={width:b.width,height:b.height},c?.(!0);return}}const h=j(u,T);h?(E(h.id),R.current={x:u-h.x,y:T-h.y},c?.(!0),m?.(h.id)):m?.(void 0)},N=(u,T)=>{if(p&&f){const h=u-w.current.x,y=T-w.current.y,s=r?.map(n=>{if(n.id!==p)return n;let a=x.current.width,P=x.current.height;switch(f){case"tl":{const A=x.current.width-h,O=x.current.height-y;a=Math.max(A,10),P=Math.max(O,10);break}case"tr":{const A=x.current.width+h,O=x.current.height-y;a=Math.max(A,10),P=Math.max(O,10);break}case"bl":{const A=x.current.width-h,O=x.current.height+y;a=Math.max(A,10),P=Math.max(O,10);break}case"br":{const A=x.current.width+h,O=x.current.height+y;a=Math.max(A,10),P=Math.max(O,10);break}}return a=Math.max(10,a),P=Math.max(10,P),{...n,width:a,height:P}});s&&v?.(s);return}if(!i)return;const b=r?.map(h=>h.id===i?{...h,x:u-R.current.x,y:T-R.current.y}:h);b&&v?.(b)},L=()=>{E(null),M(null),S(null),c?.(!1)};g.useEffect(()=>{const u=t.current;if(!u)return;const T=b=>{const h=u.getBoundingClientRect(),y=b.clientX-h.left,s=b.clientY-h.top,n=r?.find(a=>a.id===l);if(n){const a=W(n,y,s);if(a){const P={tl:"nwse-resize",br:"nwse-resize",tr:"nesw-resize",bl:"nesw-resize"};u.style.cursor=P[a];return}}u.style.cursor=i||p?"grabbing":"default"};return u.addEventListener("mousemove",T),()=>{u.removeEventListener("mousemove",T),u.style.cursor="default"}},[t,r,m,i,p]),g.useEffect(()=>{const u=t.current;if(!u)return;const T=s=>{const n=u.getBoundingClientRect();D(s.clientX-n.left,s.clientY-n.top)},b=s=>{if(!i&&!p)return;const n=u.getBoundingClientRect();N(s.clientX-n.left,s.clientY-n.top)},h=s=>{if(s.touches.length!==1)return;const n=u.getBoundingClientRect(),a=s.touches[0];D(a.clientX-n.left,a.clientY-n.top)},y=s=>{if(s.touches.length!==1||!i&&!p)return;const n=u.getBoundingClientRect(),a=s.touches[0];N(a.clientX-n.left,a.clientY-n.top)};return u.addEventListener("mousedown",T),window.addEventListener("mousemove",b),window.addEventListener("mouseup",L),u.addEventListener("touchstart",h,{passive:!1}),window.addEventListener("touchmove",y,{passive:!1}),window.addEventListener("touchend",L),()=>{u.removeEventListener("mousedown",T),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",L),u.removeEventListener("touchstart",h),window.removeEventListener("touchmove",y),window.removeEventListener("touchend",L)}},[t,i,p,f,r,v,c,m])}const V=H(()=>({canvasRefs:{},setCanvasRef:(t,o)=>{V.getState().canvasRefs[t]=o}})),ce=H(()=>{const t={current:null};return{finalImageRef:t,setFinalImage:o=>{t.current=o},getFinalImage:()=>t.current}});function Ee({canvasId:t}){const{canvasRefs:o}=V(),c=g.useRef(null),[r,l]=g.useState({x:0,y:0}),[m,v]=g.useState(!1),i=g.useRef(null),{stickers:E,selectedSticker:p}=Z(t),{canvas:{image:M,cropHeight:f,cropWidth:S,rotation:R,zoom:w},setZoom:x}=se(t),j=(s,n,a)=>Math.min(Math.max(s,n),a),W=s=>{if(!i.current||m)return;const n=w/100,a=i.current.width*n,P=i.current.height*n,A=Math.max(0,(a-S)/2),O=Math.max(0,(P-f)/2),q=j(s.x,-A,A),J=j(s.y,-O,O);l({x:q,y:J})};g.useEffect(()=>{const s=new Image;s.onload=()=>{i.current=s,y()},s.src=M},[M,w,r,R,E,p]);const D=(s,n,a)=>{s.save(),s.fillStyle="#007bff",s.strokeStyle="#fff",s.lineWidth=2,s.beginPath(),s.rect(n-10/2,a-10/2,10,10),s.fill(),s.stroke(),s.restore()},N=g.useRef({}),L=()=>{const s=c.current??o[t].current,n=s?.getContext("2d");if(!s||!n||!i.current)return;s.width=S,s.height=f,n.clearRect(0,0,S,f),n.save();const a=w/100;return n.translate(r.x+S/2,r.y+f/2),n.rotate(R*Math.PI/180),n.scale(a,a),n.drawImage(i.current,-i.current.width/2,-i.current.height/2),n.restore(),n},u=(s,n)=>{let a=N.current[n.src];if(!a){a=new Image,a.src=n.src,N.current[n.src]=a,a.onload=()=>y();return}a.complete&&s.drawImage(a,n.x,n.y,n.width,n.height)},T=(s,n)=>{s.font=`${n.height}px sans-serif`,s.textAlign="left",s.textBaseline="top",s.fillText(n.src,n.x,n.y)},b=(s,n)=>{s.strokeStyle="#007bff",s.lineWidth=2,s.strokeRect(n.x,n.y,n.width,n.height),D(s,n.x,n.y),D(s,n.x+n.width,n.y),D(s,n.x,n.y+n.height),D(s,n.x+n.width,n.y+n.height)},h=s=>{const n=s.toDataURL();return ce.getState().setFinalImage({dataUrl:n,metaData:{stickers:E??[]}}),{dataUrl:n,metaData:{stickers:E}}},y=()=>{const s=c??o[t],n=L();if(!(!n||!s.current))return E?.forEach(a=>{a.src.startsWith("data:image")||a.src.startsWith("http")?u(n,a):T(n,a),a.id===p&&b(n,a)}),h(s.current)};return we(c??o[t],t,v),{canvasRef:c,clamp:j,setCurrentZoom:x,currentZoom:w,setPosition:W,position:r,drawCanvas:y}}function pe(t,o){const c=g.useRef(!1),r=g.useRef({x:0,y:0});return{onMouseDown:i=>{c.current=!0,r.current={x:i.clientX-o.x,y:i.clientY-o.y}},onMouseMove:i=>{c.current&&t(i.clientX-r.current.x,i.clientY-r.current.y)},onMouseUp:()=>{c.current=!1}}}function be(t,o,c,r,l){const m=g.useRef(!1),v=g.useRef({x:0,y:0}),i=g.useRef(null);return{onTouchStart:f=>{if(f.touches.length===1){const S=f.touches[0];m.current=!0,v.current={x:S.clientX-o.x,y:S.clientY-o.y}}else if(f.touches.length===2){const[S,R]=Array.from(f.touches),w=Math.hypot(R.clientX-S.clientX,R.clientY-S.clientY);i.current=w}},onTouchMove:f=>{if(f.preventDefault(),f.touches.length===1&&m.current){const S=f.touches[0];t(S.clientX-v.current.x,S.clientY-v.current.y)}else if(f.touches.length===2){const[S,R]=Array.from(f.touches),w=Math.hypot(R.clientX-S.clientX,R.clientY-S.clientY);if(i.current!=null){const j=(w-i.current)*.3;c(l(r+j,10,500))}i.current=w}},onTouchEnd:()=>{m.current=!1,i.current=null}}}function ye({id:t}){const{canvasRef:o,clamp:c,setCurrentZoom:r,currentZoom:l,setPosition:m,position:v}=Ee({canvasId:t}),{onMouseDown:i,onMouseMove:E,onMouseUp:p}=pe((w,x)=>m({x:w,y:x}),v),{onTouchStart:M,onTouchMove:f,onTouchEnd:S}=be((w,x)=>m({x:w,y:x}),v,r,l,c),R=w=>{w.preventDefault();const j=-w.deltaY*.1;r(l+j)};return g.useEffect(()=>{const w=o.current;if(w)return w.addEventListener("wheel",R,{passive:!1}),()=>{w.removeEventListener("wheel",R)}},[o,l]),g.useEffect(()=>{V.getState().setCanvasRef(t,o)},[t]),B.jsx("canvas",{ref:o,style:{touchAction:"none",cursor:"grab"},onMouseDown:i,onMouseMove:E,onMouseUp:p,onMouseLeave:p,onTouchStart:M,onTouchMove:f,onTouchEnd:S})}function xe({id:t,image:o,cropWidth:c,cropHeight:r,zoom:l,rotation:m}){const{initCanvas:v}=se(t),[i,E]=g.useState(!1);return g.useEffect(()=>{v({image:o,zoom:l,cropHeight:r,cropWidth:c,rotation:m}),E(!0)},[]),B.jsx(B.Fragment,{children:i&&B.jsx(ye,{id:t})})}const ke=t=>{const{setSelectedSticker:o}=Z(t);return{exportFinalImage:async()=>{o(void 0),console.log("haloooo"),await new Promise(l=>setTimeout(l,50));const r=ce.getState().getFinalImage();return console.log(r),r}}};I.EnhancedImage=xe,I.useImageExporter=ke,I.useStickers=Z,Object.defineProperty(I,Symbol.toStringTag,{value:"Module"})});
