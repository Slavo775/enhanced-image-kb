(function(N,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],g):(N=typeof globalThis<"u"?globalThis:N||self,g(N.ReactEnahncedImage={},N.React))})(this,function(N,g){"use strict";var $={exports:{}},X={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ee;function ue(){if(ee)return X;ee=1;var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function c(o,f,m){var S=null;if(m!==void 0&&(S=""+m),f.key!==void 0&&(S=""+f.key),"key"in f){m={};for(var u in f)u!=="key"&&(m[u]=f[u])}else m=f;return f=m.ref,{$$typeof:r,type:o,key:S,ref:f!==void 0?f:null,props:m}}return X.Fragment=n,X.jsx=c,X.jsxs=c,X}var U={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te;function le(){return te||(te=1,process.env.NODE_ENV!=="production"&&function(){function r(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===s?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case p:return"Fragment";case z:return"Profiler";case I:return"StrictMode";case a:return"Suspense";case x:return"SuspenseList";case T:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case v:return"Portal";case P:return(e.displayName||"Context")+".Provider";case A:return(e._context.displayName||"Context")+".Consumer";case O:var h=e.render;return e=e.displayName,e||(e=h.displayName||h.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case E:return h=e.displayName||null,h!==null?h:r(e.type)||"Memo";case d:h=e._payload,e=e._init;try{return r(e(h))}catch{}}return null}function n(e){return""+e}function c(e){try{n(e);var h=!1}catch{h=!0}if(h){h=console;var R=h.error,_=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return R.call(h,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",_),n(e)}}function o(e){if(e===p)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===d)return"<...>";try{var h=r(e);return h?"<"+h+">":"<...>"}catch{return"<...>"}}function f(){var e=t.A;return e===null?null:e.getOwner()}function m(){return Error("react-stack-top-frame")}function S(e){if(i.call(e,"key")){var h=Object.getOwnPropertyDescriptor(e,"key").get;if(h&&h.isReactWarning)return!1}return e.key!==void 0}function u(e,h){function R(){D||(D=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",h))}R.isReactWarning=!0,Object.defineProperty(e,"key",{get:R,configurable:!0})}function k(){var e=r(this.type);return Z[e]||(Z[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function y(e,h,R,_,F,L,G,Q){return R=L.ref,e={$$typeof:b,type:e,key:h,props:L,_owner:F},(R!==void 0?R:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:k}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:G}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:Q}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function M(e,h,R,_,F,L,G,Q){var C=h.children;if(C!==void 0)if(_)if(j(C)){for(_=0;_<C.length;_++)w(C[_]);Object.freeze&&Object.freeze(C)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else w(C);if(i.call(h,"key")){C=r(e);var W=Object.keys(h).filter(function(Te){return Te!=="key"});_=0<W.length?"{key: someKey, "+W.join(": ..., ")+": ...}":"{key: someKey}",ie[C+_]||(W=0<W.length?"{"+W.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,_,C,W,C),ie[C+_]=!0)}if(C=null,R!==void 0&&(c(R),C=""+R),S(h)&&(c(h.key),C=""+h.key),"key"in h){R={};for(var K in h)K!=="key"&&(R[K]=h[K])}else R=h;return C&&u(R,typeof e=="function"?e.displayName||e.name||"Unknown":e),y(e,C,L,F,f(),R,G,Q)}function w(e){typeof e=="object"&&e!==null&&e.$$typeof===b&&e._store&&(e._store.validated=1)}var l=g,b=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),z=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),P=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),a=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),E=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),s=Symbol.for("react.client.reference"),t=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,i=Object.prototype.hasOwnProperty,j=Array.isArray,Y=console.createTask?console.createTask:function(){return null};l={"react-stack-bottom-frame":function(e){return e()}};var D,Z={},J=l["react-stack-bottom-frame"].bind(l,m)(),ae=Y(o(m)),ie={};U.Fragment=p,U.jsx=function(e,h,R,_,F){var L=1e4>t.recentlyCreatedOwnerStacks++;return M(e,h,R,!1,_,F,L?Error("react-stack-top-frame"):J,L?Y(o(e)):ae)},U.jsxs=function(e,h,R,_,F){var L=1e4>t.recentlyCreatedOwnerStacks++;return M(e,h,R,!0,_,F,L?Error("react-stack-top-frame"):J,L?Y(o(e)):ae)}}()),U}var re;function fe(){return re||(re=1,process.env.NODE_ENV==="production"?$.exports=ue():$.exports=le()),$.exports}var B=fe();const ne=r=>{let n;const c=new Set,o=(y,M)=>{const w=typeof y=="function"?y(n):y;if(!Object.is(w,n)){const l=n;n=M??(typeof w!="object"||w===null)?w:Object.assign({},n,w),c.forEach(b=>b(n,l))}},f=()=>n,u={setState:o,getState:f,getInitialState:()=>k,subscribe:y=>(c.add(y),()=>c.delete(y))},k=n=r(o,f,u);return u},de=r=>r?ne(r):ne,he=r=>r;function me(r,n=he){const c=g.useSyncExternalStore(r.subscribe,()=>n(r.getState()),()=>n(r.getInitialState()));return g.useDebugValue(c),c}const oe=r=>{const n=de(r),c=o=>me(n,o);return Object.assign(c,n),c},q=r=>r?oe(r):oe,ge=q(r=>({canvases:{},addCanvas:(n,c)=>r(o=>o.canvases[c]?o:{canvases:{...o.canvases,[c]:n}}),updateCanvas:(n,c)=>r(o=>({canvases:{...o.canvases,[c]:n}}))})),se=r=>{const{canvases:n,updateCanvas:c,addCanvas:o}=ge(),f=g.useMemo(()=>n[r],[n]);return{canvas:f,setZoom:k=>{f&&c({...f,zoom:k},r)},setRotation:k=>{f&&c({...f,rotation:k},r)},initCanvas:k=>{o(k,r)}}},ve=q(r=>({stickers:void 0,selectedSticker:void 0,addSticker:(n,c)=>r(o=>{const f=o.stickers?.[c]?.stickers||[];return{stickers:{...o.stickers,[c]:{stickers:[...f,n]}}}}),updateSticker:(n,c)=>r(o=>{const m=(o.stickers?.[c]?.stickers||[]).map(S=>S.id===n.id?n:S);return{stickers:{...o.stickers,[c]:{stickers:m}}}}),updateAll:(n,c)=>r(o=>({stickers:{...o.stickers,[c]:{stickers:n}}})),removeSticker:(n,c)=>r(o=>{const m=(o.stickers?.[c]?.stickers||[]).filter(u=>u.id!==n),S={...o.selectedSticker};return S?.[c]===n&&(S[c]=void 0),{stickers:{...o.stickers,[c]:{stickers:m}},selectedSticker:S}}),setSelectedSticker:(n,c)=>r(o=>({selectedSticker:{...o.selectedSticker,[n]:c}}))})),H=r=>{const{stickers:n,selectedSticker:c,addSticker:o,removeSticker:f,setSelectedSticker:m,updateSticker:S,updateAll:u}=ve(),k=g.useMemo(()=>n?.[r]?.stickers,[n]),y=g.useMemo(()=>c?.[r],[c]);function M(l){return`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(l)))}`}return{stickers:k,selectedSticker:y,addSticker:async l=>{let b="",v=100,p=100;if(typeof l=="string")if(b=l,b.startsWith("data:image/svg+xml")){const z=atob(b.split(",")[1]),P=new DOMParser().parseFromString(z,"image/svg+xml").querySelector("svg"),O=P?.getAttribute("width"),a=P?.getAttribute("height"),x=P?.getAttribute("viewBox");if(O&&a)v=parseFloat(O),p=parseFloat(a);else if(x){const[,,E,d]=x.split(" ").map(Number);v=E,p=d}}else if(l.includes("<svg")){b=M(l);const A=new DOMParser().parseFromString(l,"image/svg+xml").querySelector("svg"),P=A?.getAttribute("width"),O=A?.getAttribute("height"),a=A?.getAttribute("viewBox");if(P&&O)v=parseFloat(P),p=parseFloat(O);else if(a){const[,,x,E]=a.split(" ").map(Number);v=x,p=E}}else{const z=await Se(b);v=z.width,p=z.height}const I={id:new Date().toISOString(),type:"sticker",src:b,x:Math.random()*200,y:Math.random()*200,width:v,height:p};o(I,r)},removeSticker:l=>f(l,r),setSelectedSticker:l=>m(r,l),updateSticker:l=>S(l,r),updateAllStickers:l=>u(l,r)}};function Se(r){return new Promise((n,c)=>{const o=new Image;o.onload=()=>n({width:o.width,height:o.height}),o.onerror=c,o.src=r})}function we(r,n,c){const{stickers:o,selectedSticker:f,setSelectedSticker:m,updateAllStickers:S}=H(n),[u,k]=g.useState(null),[y,M]=g.useState(null),[w,l]=g.useState(null),b=g.useRef({x:0,y:0}),v=g.useRef({x:0,y:0}),p=g.useRef({width:0,height:0}),I=(a,x)=>{if(o)for(let E=o.length-1;E>=0;E--){const d=o[E];if(a>=d.x&&a<=d.x+d.width&&x>=d.y&&x<=d.y+d.height)return d}},z=(a,x,E,d=10)=>{const T={tl:{x:a.x,y:a.y},tr:{x:a.x+a.width,y:a.y},bl:{x:a.x,y:a.y+a.height},br:{x:a.x+a.width,y:a.y+a.height}};for(const s in T){if(!s)continue;const t=T[s].x,i=T[s].y;if(Math.abs(x-t)<=d&&Math.abs(E-i)<=d)return s}return null},A=(a,x)=>{const E=o?.find(T=>T.id===f);if(E){const T=z(E,a,x);if(T){M(E.id),l(T),v.current={x:a,y:x},p.current={width:E.width,height:E.height},c?.(!0);return}}const d=I(a,x);d?(k(d.id),b.current={x:a-d.x,y:x-d.y},c?.(!0),m?.(d.id)):m?.(void 0)},P=(a,x)=>{if(y&&w){const d=a-v.current.x,T=x-v.current.y,s=o?.map(t=>{if(t.id!==y)return t;let i=p.current.width,j=p.current.height;switch(w){case"tl":{const Y=p.current.width-d,D=p.current.height-T;i=Math.max(Y,10),j=Math.max(D,10);break}case"tr":{const Y=p.current.width+d,D=p.current.height-T;i=Math.max(Y,10),j=Math.max(D,10);break}case"bl":{const Y=p.current.width-d,D=p.current.height+T;i=Math.max(Y,10),j=Math.max(D,10);break}case"br":{const Y=p.current.width+d,D=p.current.height+T;i=Math.max(Y,10),j=Math.max(D,10);break}}return i=Math.max(10,i),j=Math.max(10,j),{...t,width:i,height:j}});s&&S?.(s);return}if(!u)return;const E=o?.map(d=>d.id===u?{...d,x:a-b.current.x,y:x-b.current.y}:d);E&&S?.(E)},O=()=>{k(null),M(null),l(null),c?.(!1)};g.useEffect(()=>{const a=r.current;if(!a)return;const x=E=>{const d=a.getBoundingClientRect(),T=E.clientX-d.left,s=E.clientY-d.top,t=o?.find(i=>i.id===f);if(t){const i=z(t,T,s);if(i){const j={tl:"nwse-resize",br:"nwse-resize",tr:"nesw-resize",bl:"nesw-resize"};a.style.cursor=j[i];return}}a.style.cursor=u||y?"grabbing":"default"};return a.addEventListener("mousemove",x),()=>{a.removeEventListener("mousemove",x),a.style.cursor="default"}},[r,o,m,u,y]),g.useEffect(()=>{const a=r.current;if(!a)return;const x=s=>{const t=a.getBoundingClientRect();A(s.clientX-t.left,s.clientY-t.top)},E=s=>{if(!u&&!y)return;const t=a.getBoundingClientRect();P(s.clientX-t.left,s.clientY-t.top)},d=s=>{if(s.touches.length!==1)return;const t=a.getBoundingClientRect(),i=s.touches[0];A(i.clientX-t.left,i.clientY-t.top)},T=s=>{if(s.touches.length!==1||!u&&!y)return;const t=a.getBoundingClientRect(),i=s.touches[0];P(i.clientX-t.left,i.clientY-t.top)};return a.addEventListener("mousedown",x),window.addEventListener("mousemove",E),window.addEventListener("mouseup",O),a.addEventListener("touchstart",d,{passive:!1}),window.addEventListener("touchmove",T,{passive:!1}),window.addEventListener("touchend",O),()=>{a.removeEventListener("mousedown",x),window.removeEventListener("mousemove",E),window.removeEventListener("mouseup",O),a.removeEventListener("touchstart",d),window.removeEventListener("touchmove",T),window.removeEventListener("touchend",O)}},[r,u,y,w,o,S,c,m])}const V=q(()=>({canvasRefs:{},setCanvasRef:(r,n)=>{V.getState().canvasRefs[r]=n}})),ce=q(()=>{const r={current:null};return{finalImageRef:r,setFinalImage:n=>{r.current=n},getFinalImage:()=>r.current}});function pe({canvasId:r}){const{canvasRefs:n}=V(),c=g.useRef(null),[o,f]=g.useState({x:0,y:0}),[m,S]=g.useState(!1),u=g.useRef(null),{stickers:k,selectedSticker:y}=H(r),{canvas:{image:M,cropHeight:w,cropWidth:l,rotation:b,zoom:v},setZoom:p}=se(r),I=(s,t,i)=>Math.min(Math.max(s,t),i),z=s=>{if(!u.current||m)return;const t=v/100,i=u.current.width*t,j=u.current.height*t,Y=Math.max(0,(i-l)/2),D=Math.max(0,(j-w)/2),Z=I(s.x,-Y,Y),J=I(s.y,-D,D);f({x:Z,y:J})};g.useEffect(()=>{const s=new Image;s.onload=()=>{u.current=s,T()},s.src=M},[M,v,o,b,k,y]);const A=(s,t,i)=>{s.save(),s.fillStyle="#007bff",s.strokeStyle="#fff",s.lineWidth=2,s.beginPath(),s.rect(t-10/2,i-10/2,10,10),s.fill(),s.stroke(),s.restore()},P=g.useRef({}),O=()=>{const s=c.current??n[r].current,t=s?.getContext("2d");if(!s||!t||!u.current)return;s.width=l,s.height=w,t.clearRect(0,0,l,w),t.save();const i=v/100;return t.translate(o.x+l/2,o.y+w/2),t.rotate(b*Math.PI/180),t.scale(i,i),t.drawImage(u.current,-u.current.width/2,-u.current.height/2),t.restore(),t},a=(s,t)=>{let i=P.current[t.src];if(!i){i=new Image,i.src=t.src,P.current[t.src]=i,i.onload=()=>T();return}i.complete&&s.drawImage(i,t.x,t.y,t.width,t.height)},x=(s,t)=>{s.font=`${t.height}px sans-serif`,s.textAlign="left",s.textBaseline="top",s.fillText(t.src,t.x,t.y)},E=(s,t)=>{s.strokeStyle="#007bff",s.lineWidth=2,s.strokeRect(t.x,t.y,t.width,t.height),A(s,t.x,t.y),A(s,t.x+t.width,t.y),A(s,t.x,t.y+t.height),A(s,t.x+t.width,t.y+t.height)},d=s=>{const t=s.toDataURL();return ce.getState().setFinalImage({dataUrl:t,metaData:{stickers:k??[]}}),{dataUrl:t,metaData:{stickers:k}}},T=()=>{const s=c??n[r],t=O();if(!(!t||!s.current))return k?.forEach(i=>{i.src.startsWith("data:image")||i.src.startsWith("http")?a(t,i):x(t,i),i.id===y&&E(t,i)}),d(s.current)};return we(c??n[r],r,S),{canvasRef:c,clamp:I,setCurrentZoom:p,currentZoom:v,setPosition:z,position:o,drawCanvas:T}}function be(r,n){const c=g.useRef(!1),o=g.useRef({x:0,y:0});return{onMouseDown:u=>{c.current=!0,o.current={x:u.clientX-n.x,y:u.clientY-n.y}},onMouseMove:u=>{c.current&&r(u.clientX-o.current.x,u.clientY-o.current.y)},onMouseUp:()=>{c.current=!1}}}function Ee(r,n,c,o,f){const m=g.useRef(!1),S=g.useRef({x:0,y:0}),u=g.useRef(null);return{onTouchStart:w=>{if(w.touches.length===1){const l=w.touches[0];m.current=!0,S.current={x:l.clientX-n.x,y:l.clientY-n.y}}else if(w.touches.length===2){const[l,b]=Array.from(w.touches),v=Math.hypot(b.clientX-l.clientX,b.clientY-l.clientY);u.current=v}},onTouchMove:w=>{if(w.preventDefault(),w.touches.length===1&&m.current){const l=w.touches[0];r(l.clientX-S.current.x,l.clientY-S.current.y)}else if(w.touches.length===2){const[l,b]=Array.from(w.touches),v=Math.hypot(b.clientX-l.clientX,b.clientY-l.clientY);if(u.current!=null){const I=(v-u.current)*.3;c(f(o+I,10,500))}u.current=v}},onTouchEnd:()=>{m.current=!1,u.current=null}}}function xe({id:r}){const{canvasRef:n,clamp:c,setCurrentZoom:o,currentZoom:f,setPosition:m,position:S}=pe({canvasId:r}),{onMouseDown:u,onMouseMove:k,onMouseUp:y}=be((v,p)=>m({x:v,y:p}),S),{onTouchStart:M,onTouchMove:w,onTouchEnd:l}=Ee((v,p)=>m({x:v,y:p}),S,o,f,c),b=v=>{v.preventDefault();const I=-v.deltaY*.1;o(f+I)};return g.useEffect(()=>{const v=n.current;if(v)return v.addEventListener("wheel",b,{passive:!1}),()=>{v.removeEventListener("wheel",b)}},[n,f]),g.useEffect(()=>{V.getState().setCanvasRef(r,n)},[r]),B.jsx("canvas",{ref:n,style:{touchAction:"none",cursor:"grab"},onMouseDown:u,onMouseMove:k,onMouseUp:y,onMouseLeave:y,onTouchStart:M,onTouchMove:w,onTouchEnd:l})}function ye({id:r,image:n,cropWidth:c,cropHeight:o,zoom:f,rotation:m}){const{initCanvas:S}=se(r),[u,k]=g.useState(!1);return g.useEffect(()=>{S({image:n,zoom:f,cropHeight:o,cropWidth:c,rotation:m}),k(!0)},[]),B.jsx(B.Fragment,{children:u&&B.jsx(xe,{id:r})})}const ke=r=>{const{setSelectedSticker:n}=H(r);return{exportFinalImage:async()=>(n(void 0),await new Promise(f=>setTimeout(f,50)),ce.getState().getFinalImage())}};N.EnhancedImage=ye,N.useImageExporter=ke,N.useStickers=H,Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
